# Example Automations for Routinely
# Add these to your automations.yaml or via the UI

# Mobile Notification on Task Start
- alias: "Routinely: Notify on Task Start"
  trigger:
    - platform: event
      event_type: routinely_task_started
  action:
    - service: notify.mobile_app_your_phone
      data:
        title: "{{ trigger.event.data.task_name }}"
        message: "Duration: {{ (trigger.event.data.duration / 60) | round(1) }} minutes"
        data:
          tag: routinely_task
          sticky: true
          persistent: true
          actions:
            - action: ROUTINELY_SKIP
              title: "Skip"
            - action: ROUTINELY_PAUSE
              title: "Pause"
            - action: ROUTINELY_COMPLETE
              title: "Done"

# Handle Mobile App Actions
- alias: "Routinely: Handle Notification Actions"
  trigger:
    - platform: event
      event_type: mobile_app_notification_action
  condition:
    - condition: template
      value_template: "{{ trigger.event.data.action.startswith('ROUTINELY_') }}"
  action:
    - choose:
        - conditions:
            - condition: template
              value_template: "{{ trigger.event.data.action == 'ROUTINELY_SKIP' }}"
          sequence:
            - service: routinely.skip

        - conditions:
            - condition: template
              value_template: "{{ trigger.event.data.action == 'ROUTINELY_PAUSE' }}"
          sequence:
            - service: routinely.pause

        - conditions:
            - condition: template
              value_template: "{{ trigger.event.data.action == 'ROUTINELY_COMPLETE' }}"
          sequence:
            - service: routinely.complete_task

# Task Ending Soon - Vibrate/Sound Alert
- alias: "Routinely: Task Ending Soon Alert"
  trigger:
    - platform: event
      event_type: routinely_task_ending_soon
  action:
    - service: notify.mobile_app_your_phone
      data:
        message: "{{ trigger.event.data.task_name }} ending in {{ trigger.event.data.time_remaining }} seconds"
        data:
          tag: routinely_warning
          channel: alarm_stream

# Awaiting Input Notification
- alias: "Routinely: Awaiting Input"
  trigger:
    - platform: event
      event_type: routinely_task_awaiting_input
  action:
    - service: notify.mobile_app_your_phone
      data:
        title: "Task Complete"
        message: "{{ trigger.event.data.task_name }} - tap to continue"
        data:
          tag: routinely_input
          persistent: true
          actions:
            - action: ROUTINELY_CONFIRM
              title: "Continue"
            - action: ROUTINELY_SNOOZE
              title: "Snooze 30s"

- alias: "Routinely: Handle Confirm/Snooze Actions"
  trigger:
    - platform: event
      event_type: mobile_app_notification_action
  condition:
    - condition: template
      value_template: "{{ trigger.event.data.action in ['ROUTINELY_CONFIRM', 'ROUTINELY_SNOOZE'] }}"
  action:
    - choose:
        - conditions:
            - condition: template
              value_template: "{{ trigger.event.data.action == 'ROUTINELY_CONFIRM' }}"
          sequence:
            - service: routinely.confirm

        - conditions:
            - condition: template
              value_template: "{{ trigger.event.data.action == 'ROUTINELY_SNOOZE' }}"
          sequence:
            - service: routinely.snooze
              data:
                seconds: 30

# Routine Completed Notification
- alias: "Routinely: Routine Completed"
  trigger:
    - platform: event
      event_type: routinely_routine_completed
  action:
    - service: notify.mobile_app_your_phone
      data:
        title: "Routine Complete! ðŸŽ‰"
        message: "{{ trigger.event.data.routine_name }}: {{ trigger.event.data.tasks_completed }} tasks in {{ (trigger.event.data.total_duration / 60) | round(1) }} min"
        data:
          tag: routinely_complete

# TTS Announcement on Task Start
- alias: "Routinely: TTS Task Announcement"
  trigger:
    - platform: event
      event_type: routinely_task_started
  action:
    - service: tts.speak
      target:
        entity_id: tts.google_en_com
      data:
        media_player_entity_id: media_player.living_room_speaker
        message: "Starting task: {{ trigger.event.data.task_name }}. {{ (trigger.event.data.duration / 60) | round(0) }} minutes."

# Start Morning Routine on Schedule
- alias: "Routinely: Start Morning Routine"
  trigger:
    - platform: time
      at: "07:00:00"
  condition:
    - condition: state
      entity_id: person.your_name
      state: "home"
    - condition: state
      entity_id: binary_sensor.routinely_active
      state: "off"
  action:
    - service: notify.mobile_app_your_phone
      data:
        title: "Morning Routine"
        message: "Ready to start your morning routine?"
        data:
          actions:
            - action: START_MORNING_ROUTINE
              title: "Start"
            - action: DISMISS
              title: "Not now"

- alias: "Routinely: Handle Start Morning Routine Action"
  trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: START_MORNING_ROUTINE
  action:
    - service: routinely.start
      data:
        routine_id: YOUR_MORNING_ROUTINE_ID

# Turn on Lights for Specific Tasks
- alias: "Routinely: Bathroom Lights for Brush Teeth"
  trigger:
    - platform: event
      event_type: routinely_task_started
  condition:
    - condition: template
      value_template: "{{ 'brush' in trigger.event.data.task_name.lower() or 'teeth' in trigger.event.data.task_name.lower() }}"
  action:
    - service: light.turn_on
      target:
        entity_id: light.bathroom
      data:
        brightness_pct: 100

# Start Meditation Music
- alias: "Routinely: Play Music for Meditation Task"
  trigger:
    - platform: event
      event_type: routinely_task_started
  condition:
    - condition: template
      value_template: "{{ 'meditat' in trigger.event.data.task_name.lower() }}"
  action:
    - service: media_player.play_media
      target:
        entity_id: media_player.living_room
      data:
        media_content_type: music
        media_content_id: "https://example.com/meditation_music.mp3"
